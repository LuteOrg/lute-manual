<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Command line jobs - Lute manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../css/custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Lute manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/LuteOrg/lute-manual/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="command-line-jobs"><a class="header" href="#command-line-jobs">Command line jobs</a></h1>
<p>While Lute is almost solely a web app, it has some jobs that are run from the terminal, outside of the browser.</p>
<ul>
<li><code>hello</code>: Proof-of-concept command</li>
<li><code>book_term_export</code>: Export a data file for all terms in a given book.</li>
<li><code>language_export</code>: Export a data file of all terms in a language.</li>
<li><code>import_books_from_csv</code>: Import books from a CSV file.</li>
</ul>
<h2 id="how-to-run-the-jobs"><a class="header" href="#how-to-run-the-jobs">How to run the jobs</a></h2>
<p><strong>These jobs are (currently) only runnable through the command line for pip installs.</strong></p>
<p>Lute does not need to be running when you're running a command!  Open a terminal, change directory to your Lute folder, and enter the following commands:</p>
<pre><code>source .venv/bin/activate    # Activate your virtual environment.
flask --app lute.app_factory cli &lt;command_name&gt; [arg1] [arg2...]
</code></pre>
<p>The <code>--app lute.app_factory</code> part is <strong>required</strong><sup class="footnote-reference" id="fr-these-calls-are-ugly-1"><a href="#footnote-these-calls-are-ugly">1</a></sup>.  You might be able to <a href="https://flask.palletsprojects.com/en/2.3.x/cli/#environment-variables-from-dotenv">export environment variables</a> to simplify your calls.</p>
<h2 id="sample-calls"><a class="header" href="#sample-calls">Sample calls</a></h2>
<h3 id="book_term_export"><a class="header" href="#book_term_export"><code>book_term_export</code></a></h3>
<pre><code># Usage: flask --app lute.app_factory cli book_term_export [OPTIONS] BOOKID OUTPUT_PATH
# 
#   Get all terms for the given book, and write a data file of term frequencies
#   and children.

flask --app lute.app_factory cli book_term_export 443 my_book.csv
</code></pre>
<h3 id="language_export"><a class="header" href="#language_export"><code>language_export</code></a></h3>
<pre><code># Usage: flask cli language_export [OPTIONS] LANGUAGE OUTPUT_PATH
# 
#   Get all terms from all books in the language, and write a data file of term
#   frequencies and children.

flask --app lute.app_factory cli language_export Spanish sp_terms.csv
</code></pre>
<h3 id="import_books_from_csv"><a class="header" href="#import_books_from_csv"><code>import_books_from_csv</code></a></h3>
<pre><code># Usage: flask cli import_books_from_csv [OPTIONS] CSV_FILE
#
#   Import books from a CSV file.
#
#   NOTE: By default, this will run in dry-run mode. It will print out a list of
#         changes that would be made, but not commit them. To actually import
#         the CSV file, add the --commit option to the command.
#
#   The CSV file must have a header row with the following, case-sensitive,
#   column names. The order of the columns does not matter. The CSV file may
#   include additional columns, which will be ignored.
#
#     - title: the title of the book
#
#     - text: the text of the book
#
#     - language: [optional] the name of the language of book, as it appears in
#       your language settings. If unspecified, the language specified on the
#       command line (using the --language option) will be used.
#
#     - url: [optional] the source URL for the book
#
#     - tags: [optional] a comma-separated list of tags to apply to the book
#       (e.g., "audiobook,beginner")
#
#     - audio: [optional] the path to the audio file of the book. This should
#       either be an absolute path, or a path relative to the CSV file.
#
#     - bookmarks: [optional] a semicolon-separated list of audio bookmark
#       positions, in seconds (decimals permitted; e.g., "12.34;42.89;89.00").
#
#   Example CSV file:
#
#     title,url,tags,audio,bookmarks,text
#     A Book,http://www.example.com/book,"pangram,short",book.mp3,1.00;3.14;42.00,The quick brown fox jumps over the lazy dog.

flask --app lute.app_factory cli import_books_from_csv \
    --language=English \
    --tags=audiobook,beginner \
    --commit \
    books.csv
</code></pre>
<h3 id="list-all-jobs"><a class="header" href="#list-all-jobs">List all jobs</a></h3>
<pre><code>flask --app lute.app_factory cli --help
</code></pre>
<h3 id="see-help-about-a-job"><a class="header" href="#see-help-about-a-job">See help about a job</a></h3>
<pre><code>flask --app lute.app_factory cli &lt;command_name&gt; --help
</code></pre>
<h2 id="configyml-file"><a class="header" href="#configyml-file">config.yml file</a></h2>
<p>If you have a <a href="./starting-and-stopping.html#custom-configyml">custom config.yml</a>, Lute jobs will use those settings; otherwise, it uses the built-in defaults.</p>
<h2 id="why-arent-these-built-into-the-ui"><a class="header" href="#why-arent-these-built-into-the-ui">Why aren't these built into the UI?</a></h2>
<p>Good question, here are some reasons:</p>
<ul>
<li><strong>Unsure how to add to UI.</strong> Lute is primarily for reading, and I've tried to keep the UI clean and focused on that.  Some things are <em>related</em> to Lute but don't necessarily fall within its main purpose.</li>
<li><strong>Long-running jobs.</strong> Some jobs might take a <em>long</em> time to complete.  While there are ways to have the server communicate back to a browser client (WebSockets), I have no experience with these things.</li>
<li><strong>"Good enough" is better than perfect.</strong> Shipping something working is better than trying to perfect it.  Sometimes jobs are a hacky but effective way to get things out the door.</li>
</ul>
<h2 id="docker-users"><a class="header" href="#docker-users">Docker users</a></h2>
<p>You have a few ways to run command-line jobs, if your Lute runs in Docker.  Both are a bit janky, so pick your poison.  My preference would be the first one, just because you don't have to install anything new.</p>
<h3 id="1-ssh-into-the-running-docker-instance"><a class="header" href="#1-ssh-into-the-running-docker-instance">1. ssh into the running Docker instance</a></h3>
<p>If your container is running, you can jump into it and run commands.  For example:</p>
<pre><code>$ docker ps

CONTAINER ID   IMAGE                           COMMAND            CREATED          STATUS          PORTS                    NAMES
4a01240e5678   jzohrab/lute3:latest            "/lute/start.sh"   52 seconds ago   Up 52 seconds   0.0.0.0:5001-&gt;5001/tcp   lute_test_docker-lute-1

# Connect to the running container
$ docker exec -it lute_test_docker-lute-1 /bin/bash

# Run the export.  Put the file in the lute_data folder so it's available back on the host.
root@4a01240e5678:/# flask --app lute.app_factory cli language_export English ./lute_data/MY_DATA.csv
Loading data for book Tutorial ...
... etc ...

# Leave the container
root@4a01240e5678:/# exit

# Back on the host system!
$ ls data
README.md	MY_DATA.csv	lute.db		userimages
</code></pre>
<h3 id="2-with-pip"><a class="header" href="#2-with-pip">2. With pip</a></h3>
<ul>
<li>Install Lute into a virtual environment using pip</li>
<li>Create a config.yml file with the data folder pointing to where your lute.db is stored</li>
<li>Run the commands as above.</li>
</ul>
<hr />
<hr>
<ol class="footnote-definition"><li id="footnote-these-calls-are-ugly">
<p><em>Note from the dev (me!):</em> I recognize how ugly the "--app lute.app_factory" portion of the command is, but it is not trivial to get rid of.  The commands are built on part of the framework that Lute uses, and there is no easy way to avoid the "--app" flag, as far as I know.  I tried other design options, but they all had drawbacks.  In future, these jobs may be incorporated into Lute's UI.  For now, this is good enough. <a href="#fr-these-calls-are-ugly-1">â†©</a></p>
</li>
</ol>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../backup/restore.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../usage/updating.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../backup/restore.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../usage/updating.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
